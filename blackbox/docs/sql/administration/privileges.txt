.. highlight:: psql
.. _administration-privileges:

=======================
Cluster Wide Privileges
=======================

.. note::

    Privileges are only part of the CrateDB `Enterprise Edition`_.
    When the CrateDB Enterprise Edition is disabled, there will be
    no user privilege checks, and every query will be executed
    without the validation of permissions.


``Permission Types``
====================

When a user is created, he doesn't have any privileges. The superuser can then
grant privileges to this user.

Please note that only the superuser can ``GRANT`` and ``REVOKE`` privileges.
The superuser bypasses all privileges and can access all tables in the cluster.
Therefor, It is also not possible to ``GRANT`` and ``REVOKE`` privileges to the
superuser.

User permissions are applied on the whole cluster. There is no option to ``GRANT``
or ``REVOKE`` privileges on object level, such as table or schema.


``DQL``
.......

Granting ``Data Query Language (DQL)`` permission to a user, indicates that this
user is allowed to execute ``SELECT`` and ``SHOW`` queries, as well as using
the available user defined functions.

``DML``
.......

Granting ``Data Manipulation Language (DML)`` permission to a user, indicates
that this user is allowed to execute ``INSERT``, ``UPDATE`` and ``DELETE``
queries. Users having ``DML`` permissions will still require ``DQL`` permission.


``DDL``
.......

Granting ``Data Definition Language (DDL)`` permission to a user, indicates that
this user is allowed to execute ``CREATE``, ``DROP`` and ``ALTER`` queries.


``GRANT``
=========

.. hide:

    cr> CREATE user wolfgang;
    CREATE OK, 1 row affected (... sec)

    cr> CREATE user will;
    CREATE OK, 1 row affected (... sec)

To grant a privilege to an existing user we use the :doc:`/sql/reference/grant`
SQL statement, for example::

    cr> GRANT DML TO wolfgang;
    GRANT OK, 1 row affected (... sec)


If a user with the username specified in the SQL statement does not exist the
statement returns an error::

    cr> GRANT DQL TO layla;
    UserDoesNotExistException ...


To grant ``ALL`` privileges to user will, we can use the following syntax::

    cr> GRANT ALL TO will;
    GRANT OK, 2 rows affected (... sec)

``ALL`` implies all the currently available privileges, namely ``DQL``, ``DML``
 and ``DDL``.

Privileges can be granted to multiple users in the same statement, like so::

    cr> GRANT DDL TO wolfgang, will;
    GRANT OK, 6 row affected (... sec)


``REVOKE``
==========

To revoke a privilege that was previously granted to a user use the
:doc:`/sql/reference/revoke` SQL statement, for example::

    cr> REVOKE DDL from will;
    REVOKE OK, 1 row affected (... sec)

If a user with the username specified in the SQL statement does not exist the
statement returns an error::

    cr> REVOKE DDL FROM layla;
    UserDoesNotExistException ...

``REVOKE ALL`` or ``REVOKE ALL PRIVILEGES`` will revoke all privileges
that were previously granted to a user, it can be used like this::

    cr> REVOKE ALL FROM wolfgang;
    REVOKE OK, 3 row affected (... sec)


List Privileges
===============

CrateDB exposes privileges ``sys.permissions`` system table.
Please note that this table can only be accessed by the superuser.

By querying the ``sys.permissions`` table you can get all
information regarding the existing privileges. E.g.::

    cr> SELECT * FROM sys.permissions;
    +-------------+-----------+---------+------------+-------+-----------+
    | grantor     | grantee   | class   | state      | type  | ident     |
    +-------------+-----------+---------+------------+-------+-----------+
    | crate       | will      | cluster | grant      | DML   | null      |
    | crate       | will      | cluster | grant      | DQL   | null      |
    +-------------+-----------+---------+------------+-------+-----------+
    SELECT 3 rows in set (... sec)

The column ``grantor`` shows the user who granted the privilege, the column ``grantee``
shows the user for whom the privilege was granted. The column ``class`` identifies on which
the permission exists ``ident`` stands for the ident of the object that the permission is
set on and finally ``type`` stands for the type of privilege that was granted or revoked.


.. _Enterprise Edition: https://crate.io/enterprise/
